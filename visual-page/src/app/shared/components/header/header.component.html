<mat-toolbar class="header" [class.scrolled]="isScrolled()" color="primary">
  <div class="container">
    <!-- Logo -->
    <a routerLink="/home" class="logo" mat-button (click)="closeMenu()">
      <mat-icon class="logo-icon">auto_awesome</mat-icon>
      <span class="logo-text">Visual<span class="logo-accent">Page</span></span>
    </a>

    <span class="spacer"></span>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav">
      @for (item of currentNavItems; track item.route) {
        <a
          [routerLink]="item.route"
          routerLinkActive="active"
          mat-button
          class="nav-link"
        >
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.label }}</span>
        </a>
      }

      <!-- Show "Comenzar" button only when NOT authenticated -->
      @if (!isAuthenticated()) {
        <button mat-raised-button color="accent" class="cta-button" (click)="navigateToLogin()">
          <mat-icon>rocket_launch</mat-icon>
          Comenzar
        </button>
      }

      <!-- Show user menu only when authenticated -->
      @if (isAuthenticated()) {
        <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
          <mat-icon class="user-avatar">account_circle</mat-icon>
        </button>
        <mat-menu #userMenu="matMenu" class="user-menu">
          <div class="user-menu-header">
            <mat-icon>account_circle</mat-icon>
            <div class="user-info">
              <span class="user-name">Usuario</span>
              <span class="user-email">usuario@ejemplo.com</span>
            </div>
          </div>
          <mat-divider></mat-divider>
          @for (item of userMenuItems(); track item.route) {
            <button mat-menu-item [routerLink]="item.route">
              <mat-icon>{{ item.icon }}</mat-icon>
              <span>{{ item.label }}</span>
            </button>
          }
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Cerrar Sesión</span>
          </button>
        </mat-menu>
      }
    </nav>

    <!-- Mobile Menu Button -->
    <button
      mat-icon-button
      class="mobile-menu-button"
      (click)="toggleMenu()"
      aria-label="Toggle menu"
    >
      <mat-icon>{{ isMenuOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>
  </div>
</mat-toolbar>

<!-- Mobile Navigation Drawer -->
<div class="mobile-drawer" [class.open]="isMenuOpen()">
  <div class="mobile-menu-content">
    <!-- User info for authenticated users (mobile) -->
    @if (isAuthenticated()) {
      <div class="mobile-user-header">
        <mat-icon class="mobile-user-avatar">account_circle</mat-icon>
        <div class="mobile-user-info">
          <span class="mobile-user-name">Usuario</span>
          <span class="mobile-user-email">usuario@ejemplo.com</span>
        </div>
      </div>
      <mat-divider></mat-divider>
    }

    @for (item of currentNavItems; track item.route) {
      <a
        [routerLink]="item.route"
        routerLinkActive="active"
        mat-button
        class="mobile-nav-link"
        (click)="closeMenu()"
      >
        <mat-icon>{{ item.icon }}</mat-icon>
        <span>{{ item.label }}</span>
      </a>
    }

    <!-- Show user menu items when authenticated -->
    @if (isAuthenticated()) {
      <mat-divider></mat-divider>
      @for (item of userMenuItems(); track item.route) {
        <a
          [routerLink]="item.route"
          mat-button
          class="mobile-nav-link"
          (click)="closeMenu()"
        >
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.label }}</span>
        </a>
      }
      <button
        mat-raised-button
        color="warn"
        class="mobile-logout-button"
        (click)="logout()"
      >
        <mat-icon>logout</mat-icon>
        Cerrar Sesión
      </button>
    }

    <!-- Show "Comenzar" button only when NOT authenticated -->
    @if (!isAuthenticated()) {
      <button
        mat-raised-button
        color="accent"
        class="mobile-cta-button"
        (click)="navigateToLogin()"
      >
        <mat-icon>rocket_launch</mat-icon>
        Comenzar
      </button>
    }
  </div>
</div>

<!-- Backdrop for mobile menu -->
<div class="backdrop" [class.show]="isMenuOpen()" (click)="closeMenu()"></div>
